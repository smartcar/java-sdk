plugins {
    id "com.jfrog.bintray" version "1.7.3"
}

apply plugin: 'java'
apply plugin: 'java-library'
apply plugin: 'jacoco'
apply plugin: 'maven-publish'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    jcenter()
}

dependencies {
    compile 'com.squareup.okhttp3:okhttp:3.10.0'
    compile 'com.google.code.gson:gson:2.7'
    testCompile sourceSets.main.output
    testCompile 'com.squareup.okhttp3:mockwebserver:3.4.1'
    testCompile 'org.json:json:20160810'
    testCompile 'org.powermock:powermock-release-with-testng-mockito-dependencies:1.6.2'
    testCompile 'org.testng:testng:6.9.12'
}

javadoc {
    source = sourceSets.main.allJava
    classpath = configurations.compile

    options.header = project.name
    options.windowTitle = "${project.name} - ${project.version}"
}

jar {
    manifest {
        attributes('Implementation-Title': project.name,
                   'Implementation-Version': project.version)
    }
}

task sourcesJar(type: Jar, dependsOn: classes) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

task javadocJar(type: Jar, dependsOn: javadoc) {
    classifier = 'docs'
    from javadoc.destinationDir
}

artifacts {
    archives sourcesJar
    archives javadocJar
}

test {
    useTestNG()

    // Log the results on every run.
    testLogging {
        outputs.upToDateWhen {false}
        showExceptions = true
        exceptionFormat = 'full'
        showStackTraces = true
    }

    afterTest { desc, result ->
        println "${result.resultType} ${desc.name}"
    }
}

jacoco {
    reportsDir = file("$buildDir/coverage")
}

jacocoTestReport {
    reports {
        html.enabled = true
        xml.enabled = true
    }
}

bintray {
    user = bintrayUser
    key = bintrayKey

    configurations = ['archives']

    pkg {
        repo = bintrayRepo
        name = name
        userOrg = bintrayOrg
        desc = description
        websiteUrl = developerWebsite
        issueTrackerUrl = developerIssues
        vcsUrl = vcsUrl
        licenses = [licenseId]
        publish = true
        publicDownloadNumbers = true
        githubRepo = vcsGithubRepo
        githubReleaseNotesFile = vcsGithubReadme
        version {
            name = version
            released = new Date()
        }
    }
}

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
        }
    }
}
